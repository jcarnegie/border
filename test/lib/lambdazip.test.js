import "babel/polyfill";
import proxyquire from "proxyquire";
import sinon from "sinon";
import chai from "chai";

let expect = chai.expect;

describe("Lambda Function Zip", () => {
    it ("should return a buffer", async () => {
        let zipAddLocalFolderStub = sinon.stub();
        let zipBufferStub = sinon.stub().returns(new Buffer("lambdazip"));
        let lambdazip = proxyquire("../../lib/lambdazip", {
            "adm-zip": function() {
                this.addLocalFolder = zipAddLocalFolderStub;
                this.toBuffer = zipBufferStub;
            }
        });
        let funcDir = "/some/lambda/func/dir";
        let modDirs = `${funcDir}/node_modules`;
        let buffer = await lambdazip(funcDir);

        expect(zipAddLocalFolderStub.getCall(0).args[0]).to.eql(funcDir);
        expect(buffer.toString()).eql("lambdazip");
    });
});
